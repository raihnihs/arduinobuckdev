#include <Adafruit_ADS1X15.h>
#include <Wire.h>
#define ADS1X15_ADDRESS1 0x48  // I2C address for first ADS1115
#define ADS1X15_ADDRESS2 0x49  // I2C address for second ADS1115

Adafruit_ADS1115 ads1;  // Create an instance of the first ADS1115
Adafruit_ADS1115 ads2;  // Create an instance of the second ADS1115

// function untuk sensor voltage
float voltageBuck(int adsAddress,int adcPin){
    float voltageOutput=0.0;
    float result=0.0;
    if(adsAddress==1){
      voltageOutput=ads1.readADC_SingleEnded(adcPin);
      }
    else if(adsAddress==2){
      voltageOutput=ads2.readADC_SingleEnded(adcPin);
      }
    result=voltageOutput*25.0/16835.0;
    return result;
}

//function untuk sensor arus
float currentBuck(int adscAddress, int adccPin){
    float currentOutput=0.0;
    float resultc=0.0;
    if(adscAddress==1){
      currentOutput=ads1.readADC_SingleEnded(adccPin);
      }
    else if(adscAddress==2){
      currentOutput=ads2.readADC_SingleEnded(adccPin);
      }
    resultc= (13243-currentOutput)/529.1;
    return resultc;
}

float voltage1_buck1 = 0.0; // used to store voltage value
float voltage2_buck1 = 0.0; // used to store voltage value
float current1_buck1 = 0.0; // used to store current value
float current2_buck1 = 0.0; // used to store current value

float voltage1_buck2 = 0.0; // used to store voltage value
float voltage2_buck2 = 0.0; // used to store voltage value
float current1_buck2 = 0.0; // used to store current value
float current2_buck2 = 0.0; // used to store current value

void setup(void) {
  Serial.begin(115200);
  ads1.begin(0x48);
  ads2.begin(0x49); 
}

void loop(void) {
  voltage1_buck1=voltageBuck(1,0);
  voltage2_buck1=voltageBuck(1,1);
  current1_buck1=currentBuck(1,2);
  current2_buck1=currentBuck(1,3);
  Serial.print("Nilai Tegangan1 = ");
  Serial.print(voltage1_buck1, 3); // Menampilkan 3 angka di belakang koma
  Serial.println(" Volt");
 
 delay (1000);
 
  voltage1_buck2=voltageBuck(2,0);
  voltage2_buck2=voltageBuck(2,1);
  current1_buck2=currentBuck(2,2);
  current2_buck2=currentBuck(2,3);
  Serial.print("Nilai Tegangan2 = ");
  Serial.print(voltage1_buck2, 3); // Menampilkan 3 angka di belakang koma
  Serial.println(" Volt");

 delay (1000);
}
